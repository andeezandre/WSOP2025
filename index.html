<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSOP Action Sales & Rebuy Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: 'üé∞';
            font-size: 40px;
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .header::after {
            content: 'üÉè';
            font-size: 40px;
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e1e8ed;
        }
        
        .section-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px 25px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-content {
            padding: 25px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 25px;
            padding: 5px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #2c3e50;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: middle;
        }
        
        tr:hover {
            background-color: #f8f9fa;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.2);
            transform: translateY(-1px);
        }
        
        .btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }
        
        .btn-export {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
            font-size: 16px;
            padding: 15px 30px;
        }
        
        .btn-export:hover {
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e1e8ed;
        }
        
        .summary-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 16px;
            color: #2c3e50;
        }
        
        .summary-value {
            font-weight: 600;
            color: #27ae60;
        }
        
        .calculated-cell {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            color: #155724;
            font-weight: 600;
            text-align: center;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-denied {
            background: #f8d7da;
            color: #721c24;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .export-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header::before,
            .header::after {
                display: none;
            }
            
            h1 {
                font-size: 24px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 6px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WSOP Action Sales & Rebuy Tracker</h1>
            <p class="subtitle">Professional Tournament Action Management System</p>
        </div>
        
        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('tournaments')">üèÜ Tournaments</button>
                <button class="tab" onclick="showTab('action')">üí∞ Action Sales</button>
                <button class="tab" onclick="showTab('rebuys')">üîÑ Rebuys</button>
                <button class="tab" onclick="showTab('results')">üìä Results</button>
                <button class="tab" onclick="showTab('summary')">üìà Summary</button>
            </div>
            
            <!-- TOURNAMENTS TAB -->
            <div id="tournaments" class="tab-content active">
                <div class="section">
                    <div class="section-header">
                        üèÜ Tournament Schedule
                    </div>
                    <div class="section-content">
                        <table id="tournamentTable">
                            <thead>
                                <tr>
                                    <th>Event #</th>
                                    <th>Tournament Name</th>
                                    <th>Initial Buy-in</th>
                                    <th>Date</th>
                                    <th>Rebuy Amount</th>
                                    <th>Add-on Amount</th>
                                    <th>Action Sold %</th>
                                    <th>Revenue</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="text" placeholder="#1" class="event-num"></td>
                                    <td><input type="text" placeholder="$500 Casino Employees" class="tourney-name"></td>
                                    <td><input type="number" placeholder="500" class="initial-buyin"></td>
                                    <td><input type="date" class="tourney-date"></td>
                                    <td><input type="number" placeholder="500" class="rebuy-amount"></td>
                                    <td><input type="number" placeholder="500" class="addon-amount"></td>
                                    <td class="calculated-cell action-sold-total">0%</td>
                                    <td class="calculated-cell revenue-total">$0</td>
                                    <td><button class="btn btn-danger" onclick="removeTournamentRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn" onclick="addTournamentRow()">+ Add Tournament</button>
                    </div>
                </div>
            </div>
            
            <!-- ACTION SALES TAB -->
            <div id="action" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        üí∞ Individual Action Sales
                    </div>
                    <div class="section-content">
                        <table id="actionTable">
                            <thead>
                                <tr>
                                    <th>Event #</th>
                                    <th>Investor Name</th>
                                    <th>Contact</th>
                                    <th>Action %</th>
                                    <th>Markup %</th>
                                    <th>Amount Paid</th>
                                    <th>Rebuy Limit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select class="event-select">
                                            <option value="">Select Event</option>
                                        </select>
                                    </td>
                                    <td><input type="text" placeholder="Investor Name" class="investor-name"></td>
                                    <td><input type="text" placeholder="Email/Phone" class="contact"></td>
                                    <td><input type="number" placeholder="20" min="0" max="100" class="action-percent"></td>
                                    <td><input type="number" placeholder="15" min="0" class="markup-percent"></td>
                                    <td class="calculated-cell amount-paid">$0</td>
                                    <td><input type="text" placeholder="2 rebuys + add-on" class="rebuy-limit"></td>
                                    <td><button class="btn btn-danger" onclick="removeActionRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn" onclick="addActionRow()">+ Add Action Sale</button>
                        
                        <div class="section" style="margin-top: 30px;">
                            <div class="section-header">
                                üë• Investor Summary
                            </div>
                            <div class="section-content">
                                <table id="investorSummary">
                                    <thead>
                                        <tr>
                                            <th>Investor Name</th>
                                            <th>Total Invested</th>
                                            <th>Total Action %</th>
                                            <th>Average Markup</th>
                                            <th>Events Count</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- REBUYS TAB -->
            <div id="rebuys" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        üîÑ Rebuy & Add-on Tracking
                    </div>
                    <div class="section-content">
                        <table id="rebuyTable">
                            <thead>
                                <tr>
                                    <th>Event #</th>
                                    <th>Entry Type</th>
                                    <th>Amount</th>
                                    <th>Time/Level</th>
                                    <th>Chips Received</th>
                                    <th>Pre-Approved?</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select class="rebuy-event-select">
                                            <option value="">Select Event</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select class="entry-type">
                                            <option value="Initial">Initial Buy-in</option>
                                            <option value="Rebuy">Rebuy</option>
                                            <option value="Add-on">Add-on</option>
                                        </select>
                                    </td>
                                    <td><input type="number" placeholder="500" class="rebuy-amount"></td>
                                    <td><input type="text" placeholder="Level 3" class="rebuy-time"></td>
                                    <td><input type="number" placeholder="30000" class="chips-received"></td>
                                    <td>
                                        <select class="pre-approved">
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                        </select>
                                    </td>
                                    <td><input type="text" placeholder="Bad beat on river" class="rebuy-notes"></td>
                                    <td><button class="btn btn-danger" onclick="removeRebuyRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn" onclick="addRebuyRow()">+ Add Rebuy/Add-on</button>
                        
                        <div class="section" style="margin-top: 30px;">
                            <div class="section-header">
                                ‚öñÔ∏è Rebuy Approval Status
                            </div>
                            <div class="section-content">
                                <table id="approvalTable">
                                    <thead>
                                        <tr>
                                            <th>Event #</th>
                                            <th>Entry Type</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Your Cost</th>
                                            <th>Investor Share</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- RESULTS TAB -->
            <div id="results" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        üìä Tournament Results
                    </div>
                    <div class="section-content">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th>Event #</th>
                                    <th>Tournament</th>
                                    <th>Finish</th>
                                    <th>Prize Won</th>
                                    <th>Total Cost</th>
                                    <th>Net P/L</th>
                                    <th>Investor Payout</th>
                                    <th>Your Share</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select class="result-event-select">
                                            <option value="">Select Event</option>
                                        </select>
                                    </td>
                                    <td class="calculated-cell tournament-name">-</td>
                                    <td><input type="text" placeholder="45th place" class="finish-position"></td>
                                    <td><input type="number" placeholder="0" class="prize-won"></td>
                                    <td class="calculated-cell total-cost">$0</td>
                                    <td class="calculated-cell net-pl">$0</td>
                                    <td class="calculated-cell investor-payout">$0</td>
                                    <td class="calculated-cell your-share">$0</td>
                                    <td><button class="btn btn-danger" onclick="removeResultRow(this)">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn" onclick="addResultRow()">+ Add Result</button>
                        
                        <div class="section" style="margin-top: 30px;">
                            <div class="section-header">
                                üí∏ Individual Investor Payouts
                            </div>
                            <div class="section-content">
                                <table id="payoutTable">
                                    <thead>
                                        <tr>
                                            <th>Event #</th>
                                            <th>Investor Name</th>
                                            <th>Action %</th>
                                            <th>Payout Amount</th>
                                            <th>ROI</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SUMMARY TAB -->
            <div id="summary" class="tab-content">
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3>üí∞ Financial Overview</h3>
                        <div class="summary-item">
                            <span>Total Buy-ins:</span>
                            <span class="summary-value" id="totalBuyins">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Action Revenue:</span>
                            <span class="summary-value" id="totalRevenue">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Your Bankroll Required:</span>
                            <span class="summary-value" id="bankrollRequired">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Net Bankroll Position:</span>
                            <span class="summary-value" id="netPosition">$0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h3>üîÑ Rebuy Analysis</h3>
                        <div class="summary-item">
                            <span>Pre-Approved Rebuys:</span>
                            <span class="summary-value" id="approvedRebuys">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Non-Approved (Your Cost):</span>
                            <span class="summary-value" id="nonApprovedRebuys">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Rebuy Costs:</span>
                            <span class="summary-value" id="totalRebuyCosts">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Average Per Tournament:</span>
                            <span class="summary-value" id="avgTournamentCost">$0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h3>üìä Results Summary</h3>
                        <div class="summary-item">
                            <span>Total Prizes Won:</span>
                            <span class="summary-value" id="totalPrizes">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Costs:</span>
                            <span class="summary-value" id="totalCosts">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Investor Payouts:</span>
                            <span class="summary-value" id="totalInvestorPayouts">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Your Final Profit/Loss:</span>
                            <span class="summary-value" id="finalProfitLoss">$0</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h3>üë• Investor Statistics</h3>
                        <div class="summary-item">
                            <span>Total Investors:</span>
                            <span class="summary-value" id="totalInvestors">0</span>
                        </div>
                        <div class="summary-item">
                            <span>Average Investment:</span>
                            <span class="summary-value" id="avgInvestment">$0</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Action Sold:</span>
                            <span class="summary-value" id="totalActionSold">0%</span>
                        </div>
                        <div class="summary-item">
                            <span>Average Markup:</span>
                            <span class="summary-value" id="avgMarkup">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="export-actions">
                <button class="btn btn-export" onclick="exportToCSV()">üìä Export to CSV</button>
                <button class="btn btn-export" onclick="exportToJSON()">üíæ Export to JSON</button>
                <button class="btn btn-export" onclick="printReport()">üñ®Ô∏è Print Report</button>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let tournaments = [];
        let actionSales = [];
        let rebuys = [];
        let results = [];

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update calculations when switching to summary
            if (tabName === 'summary') {
                updateSummary();
            }
            
            // Update displays
            updateEventSelects();
            updateInvestorSummary();
            updateApprovalTable();
            updatePayoutTable();
        }

        // Tournament management
        function addTournamentRow() {
            const tbody = document.querySelector('#tournamentTable tbody');
            const newRow = tbody.rows[0].cloneNode(true);
            
            // Clear inputs
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelectorAll('.calculated-cell').forEach(cell => {
                if (cell.textContent.includes('%')) cell.textContent = '0%';
                else cell.textContent = '$0';
            });
            
            tbody.appendChild(newRow);
            attachTournamentListeners(newRow);
            updateEventSelects();
        }

        function removeTournamentRow(button) {
            const tbody = document.querySelector('#tournamentTable tbody');
            if (tbody.rows.length > 1) {
                button.closest('tr').remove();
                updateEventSelects();
                updateCalculations();
            }
        }

        function attachTournamentListeners(row) {
            const inputs = row.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateCalculations);
            });
        }

        // Action sales management
        function addActionRow() {
            const tbody = document.querySelector('#actionTable tbody');
            const newRow = tbody.rows[0].cloneNode(true);
            
            // Clear inputs
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelector('.amount-paid').textContent = '$0';
            
            tbody.appendChild(newRow);
            attachActionListeners(newRow);
            updateEventSelects();
        }

        function removeActionRow(button) {
            const tbody = document.querySelector('#actionTable tbody');
            if (tbody.rows.length > 1) {
                button.closest('tr').remove();
                updateCalculations();
                updateInvestorSummary();
            }
        }

        function attachActionListeners(row) {
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    calculateActionAmount(row);
                    updateCalculations();
                    updateInvestorSummary();
                });
            });
        }

        function calculateActionAmount(row) {
            const eventNum = row.querySelector('.event-select').value;
            const actionPercent = parseFloat(row.querySelector('.action-percent').value) || 0;
            const markupPercent = parseFloat(row.querySelector('.markup-percent').value) || 0;
            
            // Find tournament buy-in
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            let buyinAmount = 0;
            
            tournamentRows.forEach(tRow => {
                const eventId = tRow.querySelector('.event-num').value;
                if (eventId === eventNum) {
                    buyinAmount = parseFloat(tRow.querySelector('.initial-buyin').value) || 0;
                }
            });
            
            const actionAmount = buyinAmount * (actionPercent / 100);
            const totalAmount = actionAmount * (1 + markupPercent / 100);
            
            row.querySelector('.amount-paid').textContent = '
             + totalAmount.toFixed(2);
        }

        // Rebuy management
        function addRebuyRow() {
            const tbody = document.querySelector('#rebuyTable tbody');
            const newRow = tbody.rows[0].cloneNode(true);
            
            // Clear inputs
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            
            tbody.appendChild(newRow);
            attachRebuyListeners(newRow);
            updateEventSelects();
        }

        function removeRebuyRow(button) {
            const tbody = document.querySelector('#rebuyTable tbody');
            if (tbody.rows.length > 1) {
                button.closest('tr').remove();
                updateApprovalTable();
                updateCalculations();
            }
        }

        function attachRebuyListeners(row) {
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    updateApprovalTable();
                    updateCalculations();
                });
            });
        }

        // Results management
        function addResultRow() {
            const tbody = document.querySelector('#resultsTable tbody');
            const newRow = tbody.rows[0].cloneNode(true);
            
            // Clear inputs
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelectorAll('.calculated-cell').forEach(cell => {
                if (cell.classList.contains('tournament-name')) cell.textContent = '-';
                else cell.textContent = '$0';
            });
            
            tbody.appendChild(newRow);
            attachResultListeners(newRow);
            updateEventSelects();
        }

        function removeResultRow(button) {
            const tbody = document.querySelector('#resultsTable tbody');
            if (tbody.rows.length > 1) {
                button.closest('tr').remove();
                updateCalculations();
                updatePayoutTable();
            }
        }

        function attachResultListeners(row) {
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    calculateResultRow(row);
                    updateCalculations();
                    updatePayoutTable();
                });
            });
        }

        function calculateResultRow(row) {
            const eventNum = row.querySelector('.result-event-select').value;
            const prizeWon = parseFloat(row.querySelector('.prize-won').value) || 0;
            
            // Find tournament name and total cost
            let tournamentName = '';
            let totalCost = 0;
            let actionSoldPercent = 0;
            
            // Get tournament name
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            tournamentRows.forEach(tRow => {
                const eventId = tRow.querySelector('.event-num').value;
                if (eventId === eventNum) {
                    tournamentName = tRow.querySelector('.tourney-name').value;
                }
            });
            
            // Calculate total cost from rebuys
            const rebuyRows = document.querySelectorAll('#rebuyTable tbody tr');
            rebuyRows.forEach(rRow => {
                const rebuyEvent = rRow.querySelector('.rebuy-event-select').value;
                if (rebuyEvent === eventNum) {
                    const amount = parseFloat(rRow.querySelector('.rebuy-amount').value) || 0;
                    totalCost += amount;
                }
            });
            
            // Get action sold percentage
            const actionRows = document.querySelectorAll('#actionTable tbody tr');
            actionRows.forEach(aRow => {
                const actionEvent = aRow.querySelector('.event-select').value;
                if (actionEvent === eventNum) {
                    const actionPercent = parseFloat(aRow.querySelector('.action-percent').value) || 0;
                    actionSoldPercent += actionPercent;
                }
            });
            
            const netPL = prizeWon - totalCost;
            const investorPayout = netPL * (actionSoldPercent / 100);
            const yourShare = netPL - investorPayout;
            
            row.querySelector('.tournament-name').textContent = tournamentName || '-';
            row.querySelector('.total-cost').textContent = '
             + totalCost.toFixed(2);
            row.querySelector('.net-pl').textContent = '
             + netPL.toFixed(2);
            row.querySelector('.investor-payout').textContent = '
             + Math.max(0, investorPayout).toFixed(2);
            row.querySelector('.your-share').textContent = '
             + yourShare.toFixed(2);
        }

        // Update event selects
        function updateEventSelects() {
            const events = [];
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            
            tournamentRows.forEach(row => {
                const eventNum = row.querySelector('.event-num').value;
                const tourneyName = row.querySelector('.tourney-name').value;
                if (eventNum && tourneyName) {
                    events.push({ num: eventNum, name: tourneyName });
                }
            });
            
            // Update all event selects
            const selects = document.querySelectorAll('.event-select, .rebuy-event-select, .result-event-select');
            selects.forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Event</option>';
                
                events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event.num;
                    option.textContent = `${event.num} - ${event.name}`;
                    if (event.num === currentValue) option.selected = true;
                    select.appendChild(option);
                });
            });
        }

        // Update calculations
        function updateCalculations() {
            // Update tournament totals
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            tournamentRows.forEach(row => {
                const eventNum = row.querySelector('.event-num').value;
                let totalActionSold = 0;
                let totalRevenue = 0;
                
                // Sum action for this event
                const actionRows = document.querySelectorAll('#actionTable tbody tr');
                actionRows.forEach(aRow => {
                    const actionEvent = aRow.querySelector('.event-select').value;
                    if (actionEvent === eventNum) {
                        const actionPercent = parseFloat(aRow.querySelector('.action-percent').value) || 0;
                        const amountText = aRow.querySelector('.amount-paid').textContent;
                        const amount = parseFloat(amountText.replace('
            , '')) || 0;
                        
                        totalActionSold += actionPercent;
                        totalRevenue += amount;
                    }
                });
                
                row.querySelector('.action-sold-total').textContent = totalActionSold.toFixed(1) + '%';
                row.querySelector('.revenue-total').textContent = '
             + totalRevenue.toFixed(2);
            });
            
            // Update result calculations
            const resultRows = document.querySelectorAll('#resultsTable tbody tr');
            resultRows.forEach(row => {
                if (row.querySelector('.result-event-select').value) {
                    calculateResultRow(row);
                }
            });
        }

        // Update investor summary
        function updateInvestorSummary() {
            const investors = {};
            
            // Collect investor data
            const actionRows = document.querySelectorAll('#actionTable tbody tr');
            actionRows.forEach(row => {
                const name = row.querySelector('.investor-name').value;
                const actionPercent = parseFloat(row.querySelector('.action-percent').value) || 0;
                const markupPercent = parseFloat(row.querySelector('.markup-percent').value) || 0;
                const amountText = row.querySelector('.amount-paid').textContent;
                const amount = parseFloat(amountText.replace('
            , '')) || 0;
                
                if (name && amount > 0) {
                    if (!investors[name]) {
                        investors[name] = {
                            totalInvested: 0,
                            totalAction: 0,
                            totalMarkup: 0,
                            eventCount: 0
                        };
                    }
                    
                    investors[name].totalInvested += amount;
                    investors[name].totalAction += actionPercent;
                    investors[name].totalMarkup += markupPercent;
                    investors[name].eventCount += 1;
                }
            });
            
            // Update summary table
            const tbody = document.querySelector('#investorSummary tbody');
            tbody.innerHTML = '';
            
            Object.entries(investors).forEach(([name, data]) => {
                const row = tbody.insertRow();
                const avgMarkup = data.eventCount > 0 ? (data.totalMarkup / data.eventCount) : 0;
                
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${data.totalInvested.toFixed(2)}</td>
                    <td>${data.totalAction.toFixed(1)}%</td>
                    <td>${avgMarkup.toFixed(1)}%</td>
                    <td>${data.eventCount}</td>
                `;
            });
        }

        // Update approval table
        function updateApprovalTable() {
            const tbody = document.querySelector('#approvalTable tbody');
            tbody.innerHTML = '';
            
            const rebuyRows = document.querySelectorAll('#rebuyTable tbody tr');
            rebuyRows.forEach(row => {
                const eventNum = row.querySelector('.rebuy-event-select').value;
                const entryType = row.querySelector('.entry-type').value;
                const amount = parseFloat(row.querySelector('.rebuy-amount').value) || 0;
                const preApproved = row.querySelector('.pre-approved').value;
                const notes = row.querySelector('.rebuy-notes').value;
                
                if (eventNum && amount > 0) {
                    // Get action sold percentage for this event
                    let actionSoldPercent = 0;
                    const actionRows = document.querySelectorAll('#actionTable tbody tr');
                    actionRows.forEach(aRow => {
                        const actionEvent = aRow.querySelector('.event-select').value;
                        if (actionEvent === eventNum) {
                            actionSoldPercent += parseFloat(aRow.querySelector('.action-percent').value) || 0;
                        }
                    });
                    
                    const investorShare = preApproved === 'Yes' ? amount * (actionSoldPercent / 100) : 0;
                    const yourCost = amount - investorShare;
                    
                    const newRow = tbody.insertRow();
                    newRow.innerHTML = `
                        <td>${eventNum}</td>
                        <td>${entryType}</td>
                        <td>${amount.toFixed(2)}</td>
                        <td><span class="status-badge status-${preApproved === 'Yes' ? 'approved' : 'denied'}">${preApproved}</span></td>
                        <td>${yourCost.toFixed(2)}</td>
                        <td>${investorShare.toFixed(2)}</td>
                        <td>${notes}</td>
                    `;
                }
            });
        }

        // Update payout table
        function updatePayoutTable() {
            const tbody = document.querySelector('#payoutTable tbody');
            tbody.innerHTML = '';
            
            const actionRows = document.querySelectorAll('#actionTable tbody tr');
            actionRows.forEach(aRow => {
                const eventNum = aRow.querySelector('.event-select').value;
                const investorName = aRow.querySelector('.investor-name').value;
                const actionPercent = parseFloat(aRow.querySelector('.action-percent').value) || 0;
                const investmentText = aRow.querySelector('.amount-paid').textContent;
                const investment = parseFloat(investmentText.replace('
            , '')) || 0;
                
                if (eventNum && investorName && actionPercent > 0) {
                    // Find result for this event
                    let netPL = 0;
                    const resultRows = document.querySelectorAll('#resultsTable tbody tr');
                    resultRows.forEach(rRow => {
                        const resultEvent = rRow.querySelector('.result-event-select').value;
                        if (resultEvent === eventNum) {
                            const netPLText = rRow.querySelector('.net-pl').textContent;
                            netPL = parseFloat(netPLText.replace('
            , '')) || 0;
                        }
                    });
                    
                    const payout = Math.max(0, netPL * (actionPercent / 100));
                    const roi = investment > 0 ? ((payout - investment) / investment * 100) : 0;
                    const status = payout > investment ? 'Profit' : payout > 0 ? 'Some Return' : 'Loss';
                    
                    const newRow = tbody.insertRow();
                    newRow.innerHTML = `
                        <td>${eventNum}</td>
                        <td>${investorName}</td>
                        <td>${actionPercent}%</td>
                        <td>${payout.toFixed(2)}</td>
                        <td>${roi.toFixed(1)}%</td>
                        <td><span class="status-badge status-${payout > investment ? 'approved' : payout > 0 ? 'pending' : 'denied'}">${status}</span></td>
                    `;
                }
            });
        }

        // Update summary
        function updateSummary() {
            let totalBuyins = 0;
            let totalRevenue = 0;
            let totalRebuyCosts = 0;
            let approvedRebuys = 0;
            let nonApprovedRebuys = 0;
            let totalPrizes = 0;
            let totalInvestorPayouts = 0;
            let totalInvestors = new Set();
            let totalActionSold = 0;
            let totalMarkup = 0;
            let markupCount = 0;
            
            // Calculate tournament totals
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            tournamentRows.forEach(row => {
                const buyin = parseFloat(row.querySelector('.initial-buyin').value) || 0;
                const revenueText = row.querySelector('.revenue-total').textContent;
                const revenue = parseFloat(revenueText.replace('
            , '')) || 0;
                
                totalBuyins += buyin;
                totalRevenue += revenue;
            });
            
            // Calculate rebuy totals
            const rebuyRows = document.querySelectorAll('#rebuyTable tbody tr');
            rebuyRows.forEach(row => {
                const amount = parseFloat(row.querySelector('.rebuy-amount').value) || 0;
                const preApproved = row.querySelector('.pre-approved').value;
                
                totalRebuyCosts += amount;
                if (preApproved === 'Yes') {
                    approvedRebuys += amount;
                } else {
                    nonApprovedRebuys += amount;
                }
            });
            
            // Calculate results totals
            const resultRows = document.querySelectorAll('#resultsTable tbody tr');
            resultRows.forEach(row => {
                const prize = parseFloat(row.querySelector('.prize-won').value) || 0;
                const payoutText = row.querySelector('.investor-payout').textContent;
                const payout = parseFloat(payoutText.replace('
            , '')) || 0;
                
                totalPrizes += prize;
                totalInvestorPayouts += payout;
            });
            
            // Calculate investor stats
            const actionRows = document.querySelectorAll('#actionTable tbody tr');
            actionRows.forEach(row => {
                const name = row.querySelector('.investor-name').value;
                const actionPercent = parseFloat(row.querySelector('.action-percent').value) || 0;
                const markup = parseFloat(row.querySelector('.markup-percent').value) || 0;
                
                if (name) {
                    totalInvestors.add(name);
                    totalActionSold += actionPercent;
                    if (markup > 0) {
                        totalMarkup += markup;
                        markupCount++;
                    }
                }
            });
            
            const bankrollRequired = totalBuyins + totalRebuyCosts - totalRevenue;
            const netPosition = totalRevenue - bankrollRequired;
            const finalProfitLoss = totalPrizes - totalBuyins - totalRebuyCosts + totalRevenue - totalInvestorPayouts;
            const avgInvestment = totalInvestors.size > 0 ? totalRevenue / totalInvestors.size : 0;
            const avgMarkup = markupCount > 0 ? totalMarkup / markupCount : 0;
            const avgTournamentCost = tournamentRows.length > 0 ? (totalBuyins + totalRebuyCosts) / tournamentRows.length : 0;
            
            // Update display
            document.getElementById('totalBuyins').textContent = '
             + totalBuyins.toFixed(2);
            document.getElementById('totalRevenue').textContent = '
             + totalRevenue.toFixed(2);
            document.getElementById('bankrollRequired').textContent = '
             + bankrollRequired.toFixed(2);
            document.getElementById('netPosition').textContent = '
             + netPosition.toFixed(2);
            document.getElementById('approvedRebuys').textContent = '
             + approvedRebuys.toFixed(2);
            document.getElementById('nonApprovedRebuys').textContent = '
             + nonApprovedRebuys.toFixed(2);
            document.getElementById('totalRebuyCosts').textContent = '
             + totalRebuyCosts.toFixed(2);
            document.getElementById('avgTournamentCost').textContent = '
             + avgTournamentCost.toFixed(2);
            document.getElementById('totalPrizes').textContent = '
             + totalPrizes.toFixed(2);
            document.getElementById('totalCosts').textContent = '
             + (totalBuyins + totalRebuyCosts).toFixed(2);
            document.getElementById('totalInvestorPayouts').textContent = '
             + totalInvestorPayouts.toFixed(2);
            document.getElementById('finalProfitLoss').textContent = '
             + finalProfitLoss.toFixed(2);
            document.getElementById('totalInvestors').textContent = totalInvestors.size;
            document.getElementById('avgInvestment').textContent = '
             + avgInvestment.toFixed(2);
            document.getElementById('totalActionSold').textContent = totalActionSold.toFixed(1) + '%';
            document.getElementById('avgMarkup').textContent = avgMarkup.toFixed(1) + '%';
        }

        // Export functions
        function exportToCSV() {
            let csv = 'WSOP Action Sales Report\n\n';
            
            // Tournament data
            csv += 'TOURNAMENTS\n';
            csv += 'Event,Name,Initial Buy-in,Date,Rebuy Amount,Add-on Amount,Action Sold %,Revenue\n';
            const tournamentRows = document.querySelectorAll('#tournamentTable tbody tr');
            tournamentRows.forEach(row => {
                const cells = [
                    row.querySelector('.event-num').value,
                    row.querySelector('.tourney-name').value,
                    row.querySelector('.initial-buyin').value,
                    row.querySelector('.tourney-date').value,
                    row.querySelector('.rebuy-amount').value,
                    row.querySelector('.addon-amount').value,
                    row.querySelector('.action-sold-total').textContent,
                    row.querySelector('.revenue-total').textContent
                ];
                csv += cells.join(',') + '\n';
            });
            
            csv += '\nACTION SALES\n';
            csv += 'Event,Investor,Contact,Action %,Markup %,Amount Paid,Rebuy Limit\n';
            const actionRows = document.querySelectorAll('#actionTable tbody tr');
            actionRows.forEach(row => {
                const cells = [
                    row.querySelector('.event-select').value,
                    row.querySelector('.investor-name').value,
                    row.querySelector('.contact').value,
                    row.querySelector('.action-percent').value,
                    row.querySelector('.markup-percent').value,
                    row.querySelector('.amount-paid').textContent,
                    row.querySelector('.rebuy-limit').value
                ];
                csv += cells.join(',') + '\n';
            });
            
            csv += '\nREBUYS\n';
            csv += 'Event,Entry Type,Amount,Time,Chips,Pre-Approved,Notes\n';
            const rebuyRows = document.querySelectorAll('#rebuyTable tbody tr');
            rebuyRows.forEach(row => {
                const cells = [
                    row.querySelector('.rebuy-event-select').value,
                    row.querySelector('.entry-type').value,
                    row.querySelector('.rebuy-amount').value,
                    row.querySelector('.rebuy-time').value,
                    row.querySelector('.chips-received').value,
                    row.querySelector('.pre-approved').value,
                    row.querySelector('.rebuy-notes').value
                ];
                csv += cells.join(',') + '\n';
            });
            
            csv += '\nRESULTS\n';
            csv += 'Event,Tournament,Finish,Prize,Total Cost,Net P/L,Investor Payout,Your Share\n';
            const resultRows = document.querySelectorAll('#resultsTable tbody tr');
            resultRows.forEach(row => {
                const cells = [
                    row.querySelector('.result-event-select').value,
                    row.querySelector('.tournament-name').textContent,
                    row.querySelector('.finish-position').value,
                    row.querySelector('.prize-won').value,
                    row.querySelector('.total-cost').textContent,
                    row.querySelector('.net-pl').textContent,
                    row.querySelector('.investor-payout').textContent,
                    row.querySelector('.your-share').textContent
                ];
                csv += cells.join(',') + '\n';
            });
            
            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wsop_action_sales_complete.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportToJSON() {
            const data = {
                tournaments: [],
                actionSales: [],
                rebuys: [],
                results: [],
                exportDate: new Date().toISOString()
            };
            
            // Collect all data
            document.querySelectorAll('#tournamentTable tbody tr').forEach(row => {
                data.tournaments.push({
                    eventNum: row.querySelector('.event-num').value,
                    name: row.querySelector('.tourney-name').value,
                    initialBuyin: row.querySelector('.initial-buyin').value,
                    date: row.querySelector('.tourney-date').value,
                    rebuyAmount: row.querySelector('.rebuy-amount').value,
                    addonAmount: row.querySelector('.addon-amount').value
                });
            });
            
            document.querySelectorAll('#actionTable tbody tr').forEach(row => {
                data.actionSales.push({
                    eventNum: row.querySelector('.event-select').value,
                    investorName: row.querySelector('.investor-name').value,
                    contact: row.querySelector('.contact').value,
                    actionPercent: row.querySelector('.action-percent').value,
                    markupPercent: row.querySelector('.markup-percent').value,
                    rebuyLimit: row.querySelector('.rebuy-limit').value
                });
            });
            
            document.querySelectorAll('#rebuyTable tbody tr').forEach(row => {
                data.rebuys.push({
                    eventNum: row.querySelector('.rebuy-event-select').value,
                    entryType: row.querySelector('.entry-type').value,
                    amount: row.querySelector('.rebuy-amount').value,
                    time: row.querySelector('.rebuy-time').value,
                    chips: row.querySelector('.chips-received').value,
                    preApproved: row.querySelector('.pre-approved').value,
                    notes: row.querySelector('.rebuy-notes').value
                });
            });
            
            document.querySelectorAll('#resultsTable tbody tr').forEach(row => {
                data.results.push({
                    eventNum: row.querySelector('.result-event-select').value,
                    finishPosition: row.querySelector('.finish-position').value,
                    prizeWon: row.querySelector('.prize-won').value
                });
            });
            
            // Download
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wsop_action_sales_backup.json';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printReport() {
            window.print();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Attach listeners to initial rows
            document.querySelectorAll('#tournamentTable tbody tr').forEach(attachTournamentListeners);
            document.querySelectorAll('#actionTable tbody tr').forEach(attachActionListeners);
            document.querySelectorAll('#rebuyTable tbody tr').forEach(attachRebuyListeners);
            document.querySelectorAll('#resultsTable tbody tr').forEach(attachResultListeners);
            
            // Initial updates
            updateEventSelects();
            updateCalculations();
            updateSummary();
        });
    </script>
</body>
</html>
            